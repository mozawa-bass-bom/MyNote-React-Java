{
	"info": {
		"_postman_id": "5dcd3045-cb87-4b77-833f-48c374a4252d",
		"name": "MyNote API Tests",
		"description": "MyNote Java Spring API – Auth / Categories / Contacts / Notes / Admin / Upload(SSE)",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "48987996",
		"_collection_link": "https://mozawabass-9212635.postman.co/workspace/Motoyoshi-Ozawa's-Workspace~88be2bf7-83b5-45a1-8782-112d646001be/collection/48987996-5dcd3045-cb87-4b77-833f-48c374a4252d?action=share&source=collection_link&creator=48987996"
	},
	"item": [
		{
			"name": "05 Auth",
			"item": [
				{
					"name": "POST /api/auth/login (user)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userName\": \"{{ok_username}}\",\n  \"password\": \"{{ok_password}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						},
						"description": "ユーザーでログイン。Cookie Jarにセッションが保存される。"
					},
					"response": []
				},
				{
					"name": "POST /api/auth/login (admin)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userName\": \"{{admin_username}}\",\n  \"password\": \"{{admin_password}}\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "POST /api/auth/availability (username only)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"userName\": \"user5\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/availability",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"availability"
							]
						}
					},
					"response": []
				},
				{
					"name": "POST /api/auth/availability (both missing → 400想定)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\"email\":\"test@ex.com\"}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/availability",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"availability"
							]
						}
					},
					"response": []
				},
				{
					"name": "POST /api/auth/register",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"userName\": \"user_{{$timestamp}}\",\n  \"password\": \"userpass\",\n  \"email\": \"user_{{$timestamp}}@example.com\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"register"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET /api/auth/logout",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/logout",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"logout"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "06 Password Reset",
			"item": [
				{
					"name": "POST /api/auth/password-reset/request",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "User-Agent",
								"value": "PostmanRuntime/1.0"
							},
							{
								"key": "X-Forwarded-For",
								"value": "203.0.113.5"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"email\": \"{{reset_email}}\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/password-reset/request?appBaseUrl=https://app.mynote.local",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"password-reset",
								"request"
							],
							"query": [
								{
									"key": "appBaseUrl",
									"value": "https://app.mynote.local"
								}
							]
						},
						"description": "存在漏洩防止のため常に200"
					},
					"response": []
				},
				{
					"name": "GET /api/auth/password-reset/verify (true)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/password-reset/verify?token={{good_token}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"password-reset",
								"verify"
							],
							"query": [
								{
									"key": "token",
									"value": "{{good_token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "GET /api/auth/password-reset/verify (false)",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/auth/password-reset/verify?token={{bad_token}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"password-reset",
								"verify"
							],
							"query": [
								{
									"key": "token",
									"value": "{{bad_token}}"
								}
							]
						}
					},
					"response": []
				},
				{
					"name": "POST /api/auth/password-reset/complete (ok)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"token\": \"{{good_token}}\", \"newPassword\": \"Str0ngPass!2025\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/password-reset/complete",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"password-reset",
								"complete"
							]
						}
					},
					"response": []
				},
				{
					"name": "POST /api/auth/password-reset/complete (ng)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"token\": \"{{bad_token}}\", \"newPassword\": \"Str0ngPass!2025\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/auth/password-reset/complete",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"auth",
								"password-reset",
								"complete"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "20 Categories",
			"item": [
				{
					"name": "GET /api/notes/categories",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/categories",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"categories"
							]
						},
						"description": "AuthFilter + Cookie（ログイン実行済み）必須"
					},
					"response": []
				},
				{
					"name": "POST /api/notes/categories/create",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"name\": \"Books\", \"description\": \"Tech & Jazz notes\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/notes/categories/create",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"categories",
								"create"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET /api/notes/categories/:id/prompts",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/categories/{{exist_category_id}}/prompts",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"categories",
								"{{exist_category_id}}",
								"prompts"
							]
						}
					},
					"response": []
				},
				{
					"name": "PATCH /api/notes/categories/:id (rename)",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Cookie",
								"value": "token= {{user_jwt}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"name\": \"Books (Renamed)\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/notes/categories/{{exist_category_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"categories",
								"{{exist_category_id}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "DELETE /api/notes/categories/:id",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/categories/{{exist_category_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"categories",
								"{{exist_category_id}}"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "30 Contacts",
			"item": [
				{
					"name": "POST /api/contacts",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"name\": \"Alice\",\n  \"email\": \"alice@example.com\",\n  \"message\": \"問い合わせテストです。\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/contacts",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"contacts"
							]
						},
						"description": "@SessionAttribute(\"userId\") を読むためログインCookie必須（AuthFilterは対象外）"
					},
					"response": []
				}
			]
		},
		{
			"name": "40 Notes",
			"item": [
				{
					"name": "POST /api/notes/create",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"categoryId\": {{exist_category_id}},\n  \"title\": \"My new note\",\n  \"description\": \"hello\",\n  \"originalFilename\":\"test.pdf\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/api/notes/create",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"create"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET /api/notes",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET /api/notes/toc",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/toc",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"toc"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET /api/notes/pages",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/pages",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"pages"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET /api/notes/:userSeqId",
					"request": {
						"method": "PATCH",
						"header": [],
						"url": {
							"raw": "{{base_url}}/api/notes/{{exist_user_seqno}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"{{exist_user_seqno}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "PATCH /api/notes/:seq/description",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"description\": \"<p>updated by Postman</p>\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/notes/{{exist_user_seqno}}/description",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"{{exist_user_seqno}}",
								"description"
							]
						}
					},
					"response": []
				},
				{
					"name": "PATCH /api/notes/toc/:tocId/rename",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"title\": \"New TOC Title\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/notes/toc/{{exist_toc_id}}/rename",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"toc",
								"{{exist_toc_id}}",
								"rename"
							]
						}
					},
					"response": []
				},
				{
					"name": "PATCH /api/notes/pages/:pageId/text",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"extractedText\": \"Updated OCR text\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/notes/pages/{{exist_page_id}}/text",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"pages",
								"{{exist_page_id}}",
								"text"
							]
						}
					},
					"response": []
				},
				{
					"name": "DELETE /api/notes/:seq",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/{{exist_user_seqno}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"{{exist_user_seqno}}"
							]
						}
					},
					"response": []
				},
				{
					"name": "DELETE /api/notes/userdelate (self all)",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/userdelate",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"userdelate"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "45 Admin",
			"item": [
				{
					"name": "GET /api/notes/admin/contacts",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/admin/contacts",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"admin",
								"contacts"
							]
						}
					},
					"response": []
				},
				{
					"name": "GET /api/notes/admin/users",
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/admin/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"admin",
								"users"
							]
						}
					},
					"response": []
				},
				{
					"name": "DELETE /api/notes/admin/userDelete/:userId",
					"request": {
						"method": "DELETE",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_jwt}}"
							}
						],
						"url": {
							"raw": "{{base_url}}/api/notes/admin/userDelete/1",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"admin",
								"userDelete",
								"1"
							]
						},
						"description": "タイポ修正後パス"
					},
					"response": []
				},
				{
					"name": "PATCH /api/notes/admin/users/:userId/role",
					"request": {
						"method": "PATCH",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{admin_jwt}}"
							},
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{ \"role\": \"admin\" }"
						},
						"url": {
							"raw": "{{base_url}}/api/notes/admin/users/2/role",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"admin",
								"users",
								"2",
								"role"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "50 Upload (SSE)",
			"item": [
				{
					"name": "POST /api/notes/upload/process-stream (new cat, no name → SSE error)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Accept",
								"value": "text/event-stream"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "createNewCategory",
									"value": "true",
									"type": "text"
								},
								{
									"key": "noteTitle",
									"value": "Test Note",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/notes/upload/process-stream",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"upload",
								"process-stream"
							]
						},
						"description": "SSEで newCategoryName 必須エラーが返ることを確認"
					},
					"response": []
				},
				{
					"name": "POST /api/notes/upload/process-stream (existing, missing id → SSE error)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Accept",
								"value": "text/event-stream"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "createNewCategory",
									"value": "false",
									"type": "text"
								},
								{
									"key": "noteTitle",
									"value": "Test Note",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/notes/upload/process-stream",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"upload",
								"process-stream"
							]
						}
					},
					"response": []
				},
				{
					"name": "POST /api/notes/upload/process-stream (mode=simple)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Accept",
								"value": "text/event-stream"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "createNewCategory",
									"value": "false",
									"type": "text"
								},
								{
									"key": "existingCategoryId",
									"value": "{{exist_category_id}}",
									"type": "text"
								},
								{
									"key": "mode",
									"value": "simple",
									"type": "text"
								},
								{
									"key": "noteTitle",
									"value": "SSE Simple",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/notes/upload/process-stream",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"upload",
								"process-stream"
							]
						}
					},
					"response": []
				},
				{
					"name": "POST /api/notes/upload/process-stream (new cat ok, no file → SSE starts)",
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Authorization",
								"value": "Bearer {{user_jwt}}"
							},
							{
								"key": "Accept",
								"value": "text/event-stream"
							}
						],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "createNewCategory",
									"value": "true",
									"type": "text"
								},
								{
									"key": "newCategoryName",
									"value": "Books From SSE",
									"type": "text"
								},
								{
									"key": "noteTitle",
									"value": "My SSE Note",
									"type": "text"
								},
								{
									"key": "tocPrompt",
									"value": "{{toc_prompt}}",
									"type": "text"
								},
								{
									"key": "pagePrompt",
									"value": "{{page_prompt}}",
									"type": "text"
								},
								{
									"key": "saveAsDefault",
									"value": "true",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{base_url}}/api/notes/upload/process-stream",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"api",
								"notes",
								"upload",
								"process-stream"
							]
						},
						"description": "SSE接続開始までの前段確認（PDF未添付）"
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"requests": {},
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8080"
		},
		{
			"key": "ok_username",
			"value": "user1"
		},
		{
			"key": "ok_password",
			"value": "password1"
		},
		{
			"key": "admin_username",
			"value": "admin1"
		},
		{
			"key": "admin_password",
			"value": "adminpass"
		},
		{
			"key": "user_jwt",
			"value": "PUT_USER_JWT_HERE"
		},
		{
			"key": "admin_jwt",
			"value": "PUT_ADMIN_JWT_HERE"
		},
		{
			"key": "exist_category_id",
			"value": "5"
		},
		{
			"key": "exist_user_seqno",
			"value": "11"
		},
		{
			"key": "exist_toc_id",
			"value": "11"
		},
		{
			"key": "exist_page_id",
			"value": "22"
		},
		{
			"key": "reset_email",
			"value": "user1@example.com"
		},
		{
			"key": "good_token",
			"value": "valid-reset-token"
		},
		{
			"key": "bad_token",
			"value": "invalid-or-expired-token"
		},
		{
			"key": "toc_prompt",
			"value": "Make table of contents"
		},
		{
			"key": "page_prompt",
			"value": "Explain each page"
		}
	]
}